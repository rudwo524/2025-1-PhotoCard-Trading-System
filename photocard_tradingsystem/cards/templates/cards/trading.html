

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>카드 트레이딩 시스템</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #eef4f8;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
    header {
      background-color: #2c3e50;
      padding: 20px;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: #ecf0f1;
    }
    .main-section {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .card-list-container {
      flex: 6;
      padding: 20px;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .card-detail-container {
      flex: 4;
      padding: 20px;
      background-color: #ffffff;
      box-sizing: border-box;
      border-left: 1px solid #ccc;
      overflow-y: auto;
    }
    .search-box {
      margin-bottom: 20px;
    }
    .search-box input, .search-box select {
      padding: 6px 10px;
      margin-right: 10px;
      font-size: 14px;
    }
    .card-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      justify-content: center;
    }
    .card-item {
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      background: #ffffff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
      cursor: pointer;
      text-align: center;
      padding: 10px;
    }
    .card-item:hover {
      transform: scale(1.02);
    }
    .card-item img {
      width: auto;
      height: auto;
      max-height: 140px;
      max-width: 100%;
      object-fit: contain;
      display: block;
      margin: 0 auto 10px;
    }
    .card-info h3 {
      margin: 0;
      font-size: 16px;
      color: #2c3e50;
    }
    .card-info p {
      font-size: 13px;
      color: #566573;
      margin: 3px 0;
    }
    .trade-button {
      margin-top: 5px;
      padding: 6px 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }
    .trade-button:hover {
      background-color: #2980b9;
    }
    
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>카드 트레이딩 시스템</header>
  <div class="main-section">
    <div class="card-list-container">
      <div class="search-box">
        <input type="text" id="search" onkeyup="filterCards()" placeholder="카드 이름 검색" />
        <select id="grade-filter" onchange="filterCards()">
          <option value="">전체 등급</option>
          <option value="S">S</option>
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
        </select>
        <select id="category-filter" onchange="filterCards()">
          <option value="">전체 카테고리</option>
          <option value="건물">건물</option>
          <option value="이벤트">이벤트</option>
          <option value="동아리">동아리</option>
          <option value="음식">음식</option>
        </select>
        <select id="sort-filter" onchange="filterCards()">
          <option value="">정렬 선택</option>
          <option value="price-asc">가격 낮은 순</option>
          <option value="price-desc">가격 높은 순</option>
        </select>
      </div>
      <div class="card-list" id="card-list"></div>
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="prevPage()">이전</button>
        <span id="page-indicator">1</span>
        <button onclick="nextPage()">다음</button>
        <button onclick="toggleFavoritesView()" id="favToggle">즐겨찾기만 보기</button>
      </div>
    </div>
    <div class="card-detail-container" id="card-detail">
      <h3>카드 상세 정보</h3>
      <p>카드를 클릭하면 오른쪽에 상세 정보가 나타납니다.</p>
    </div>
  </div>
  <script>
    const cardData = {{ card_data|safe }};
    const favoriteSet = new Set();
    
    let currentPage = 1;
    const perPage = 12;
    let showOnlyFavorites = false;
    let chart;

    function toggleFavoritesView() {
      showOnlyFavorites = !showOnlyFavorites;
      document.getElementById("favToggle").textContent = showOnlyFavorites ? "전체 보기" : "즐겨찾기만 보기";
      currentPage = 1;
      renderCards();
    }

    function toggleFavorite(id) {
      if (favoriteSet.has(id)) favoriteSet.delete(id);
      else favoriteSet.add(id);
      renderCards();
    }

    function renderCards() {
      const cardList = document.getElementById('card-list');
      cardList.innerHTML = '';
      const query = document.getElementById('search')?.value.toLowerCase() || "";
      const grade = document.getElementById('grade-filter')?.value || "";
      const category = document.getElementById('category-filter')?.value || "";
      const sortBy = document.getElementById('sort-filter')?.value || "";
      let filtered = cardData.filter(c => {
        const match = c.title.toLowerCase().includes(query) &&
                      (!grade || c.grade === grade) &&
                      (!category || c.category === category);
        const favMatch = !showOnlyFavorites || favoriteSet.has(c.id);
        return match && favMatch;
      });
      filtered.sort((a, b) => {
        const aFav = favoriteSet.has(a.id);
        const bFav = favoriteSet.has(b.id);
        if (aFav === bFav) return 0;
        return aFav ? -1 : 1;
      });
      if (sortBy === 'price-asc') filtered.sort((a, b) => a.price - b.price);
      if (sortBy === 'price-desc') filtered.sort((a, b) => b.price - a.price);
      const total = filtered.length;
      const maxPage = Math.ceil(total / perPage) || 1;
      currentPage = Math.min(currentPage, maxPage);
      const start = (currentPage - 1) * perPage;
      const end = start + perPage;
      const pageData = filtered.slice(start, end);
      pageData.forEach(card => {
        const div = document.createElement('div');
        div.className = 'card-item';
        div.setAttribute('data-grade', card.grade);
        div.setAttribute('data-category', card.category);
        div.onclick = () => showCardDetail(card);
        const isFav = favoriteSet.has(card.id);
        div.innerHTML = `
          <img src="${card.image}" alt="${card.title}">
          <div class="card-info">
            <h3>${card.title}</h3>
            <p>등급: ${card.grade}</p>
            <p>카테고리: ${card.category}</p>
            <p>가격: ${card.price}원</p>
            <button class="trade-button" onclick="event.stopPropagation(); alert('구매 요청 전송');">구매</button>
            <button class="trade-button" onclick="event.stopPropagation(); alert('판매 요청 전송');">판매</button>
            <button class="trade-button" onclick="event.stopPropagation(); toggleFavorite(${card.id});">
              ${isFav ? '★ 즐겨찾기 해제' : '☆ 즐겨찾기 추가'}
            </button>
          </div>
        `;
        cardList.appendChild(div);
      });
      document.getElementById('page-indicator').innerText = `${currentPage} / ${maxPage}`;
    }

    function showCardDetail(card) {
      const detail = document.getElementById("card-detail");
      detail.innerHTML = `
        <h3>${card.title} 상세 정보</h3>
        <p>등급: ${card.grade}</p>
        <p>카테고리: ${card.category}</p>
        <p>가격: ${card.price}원</p>
        <p>설명: ${card.description}</p>
        <img src="${card.image}" style="width: 220px; height: 120px; object-fit: contain; display: block; margin: 10px;">
        <canvas id="chart" width="300" height="200"></canvas>
        <button class='trade-button' onclick='alert("구매 요청이 전송되었습니다.")'>구매</button>
        <button class='trade-button' onclick='alert("구매 요청이 전송되었습니다.")'>판매</button>
      `;
      setTimeout(() => renderChart(card), 10);
    }

    function renderChart(card) {
  const ctx = document.getElementById('chart').getContext('2d');
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['7일 전', '6일 전', '5일 전', '4일 전', '3일 전', '2일 전', '1일 전'],
      datasets: [{
        label: '가격 추이',
        data: card.history,
        borderColor: '#3498db',
        backgroundColor: 'rgba(52, 152, 219, 0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: false, // 🔥 이거 껐다!
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: false } }
    }
  });
}
    function filterCards() {
      currentPage = 1;
      renderCards();
    }

    function nextPage() {
      currentPage++;
      renderCards();
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderCards();
      }
    }

    window.onload = () => renderCards();
  </script>
</body>
</html>